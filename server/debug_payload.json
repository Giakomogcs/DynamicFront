{
  "messages": [
    {
      "role": "user",
      "content": "\nYou are the UI DESIGNER Agent.\nYour input: A summary text, a set of raw data blocks, and the EXECUTION PLAN used to get this data.\nYour goal: Generate a JSON array of \"Widgets\" to visualize this data and the process.\n\nInput Text: \"Não foram encontradas unidades do SENAI registradas na cidade de Diadema na base consultada. Se desejar, posso ampliar a busca para cidades próximas ou para o estado de São Paulo. Deseja tentar outra localidade ou receber informações de unidades mais próximas?\"\nInput Data: [{\"tool\":\"api_5d194bb6-1118-4cce-bbf0-395d6fa17e11__dn_companiescontroller_getsenaiunits\",\"result\":{\"content\":[{\"type\":\"text\",\"text\":\"{\\\"unidades\\\":[],\\\"meta\\\":{\\\"totalItems\\\":0,\\\"filtrosAplicados\\\":{\\\"state\\\":null,\\\"city\\\":\\\"DIADEMA\\\",\\\"distanceKm\\\":null}}}\"},{\"type\":\"text\",\"text\":\"\\n[SYSTEM HINT]: The search returned NO results for \\\"DIADEMA\\\". \\n1. Try REMOVING accents (e.g. \\\"São Paulo\\\" -> \\\"Sao Paulo\\\").\\n2. Try UPPERCASE or lowercase.\\n3. Try a broader search term.\\n\\n[AUTH HINT]: If this tool requires login, ensure you have called the authentication tool first. If you suspect missing privileges, report this to the user.\"}]}}]\nExecution Strategy (Steps): [{\"name\":\"Buscar unidades SENAI em Diadema\",\"description\":\"Utilizar a ferramenta para listar todas as unidades SENAI na cidade de Diadema.\",\"expected_tools\":[\"api_5d194bb6-1118-4cce-bbf0-395d6fa17e11__dn_companiescontroller_getsenaiunits\"]}]\n\nWIDGET TYPES (Use these to tell a STORY):\n1. **process**: { \"type\": \"process\", \"title\": \"Execution Pipeline\", \"steps\": [{ \"name\": \"Step 1\", \"status\": \"completed\", \"description\": \"...\" }] }\n   - ALWAYS start with this to show *how* you got the data. Reflect the \"Execution Strategy\".\n2. **stat**: { \"type\": \"stat\", \"data\": [{ \"label\": \"X\", \"value\": \"Y\", \"change\": \"+10%\", \"icon\": \"trending_up\" }] }\n   - Use for Key Performance Indicators or simple counts (e.g., \"Total Schools Found\").\n3. **chart**: { \"type\": \"chart\", \"config\": { \"chartType\": \"bar|line|pie|area\", \"title\": \"Meaningful Title\", \"description\": \"What this chart shows\", \"actions\": [] }, \"data\": [...] }\n   - Use 'bar' for comparisons (e.g. Courses per Branch).\n   - Use 'pie' for distribution (e.g. Schools by City).\n4. **table**: { \"type\": \"table\", \"title\": \"Detailed Data\", \"data\": [...], \"actions\": [] }\n   - Use for granular listings.\n5. **insight**: { \"type\": \"insight\", \"title\": \"Analysis / Status\", \"content\": [\"Bullet point 1\", \"Bullet point 2\"], \"sentiment\": \"neutral|warning|success\", \"actions\": [] }\n   - Use to summarize findings, give warnings (e.g. \"No schools found in X\"), or provide recommendations.\n6. **expandable**: { \"type\": \"expandable\", \"title\": \"Detailed Breakdown\", \"sections\": [{ \"title\": \"Section 1\", \"content\": \"...\", \"data\": [...] }] }\n   - Use for hierarchical data (e.g., Courses → Units → Lessons).\n7. **comparison**: { \"type\": \"comparison\", \"title\": \"Side-by-Side Comparison\", \"items\": [{ \"name\": \"Item A\", \"metrics\": {...} }, { \"name\": \"Item B\", \"metrics\": {...} }] }\n   - Use to compare similar entities.\n\n**INTERACTIVITY & ACTIONS (NEW)**:\nYou can add an \"actions\" array to widgets (chart, table, insight) to make them interactive.\nAction Schema: ` { \"label\": \"Button Text\", \"type\": \"tool_call\", \"tool\": \"tool_name\", \"args\": { \"arg1\": \"value\" }, \"style\": \"primary|secondary\" } `\nOR for Navigation: ` { \"label\": \"Open Analysis\", \"type\": \"navigate_canvas\", \"canvasId\": \"new_id_or_null_to_create\", \"style\": \"link\" } `\n\n**WHEN TO USE ACTIONS:**\n1. **Drill Down**: If showing a list of entities (e.g. Schools), add an action to fetch details (e.g. \"View Courses\").\n   - Example: For a table of Schools, each row acts as context, but you can add a global action \"Analyze All Courses\".\n   - *Advanced*: You can currently only add Global Actions to the widget.\n2. **Follow-up**: If a process failed or had warnings, add an action to \"Retry with X\" or \"Search Y instead\".\n3. **New Analysis**: If the data is dense, add an action \"Create Dedicated Canvas\" (`navigate_canvas`).\n\nINTELLIGENT INSIGHTS (CRITICAL):\nWhen analyzing data, you MUST:\n1. **Detect Relationships**: Identify duplicate or similar items across different locations/categories\n2. **Proximity Grouping**: When dealing with location data, group by:\n   - Nearest/closest items (top 3-5)\n   - Regional grouping (same city/state)\n   - Overall distribution\n3. **Complete Details**: For courses, schools, or services, include:\n   - Full descriptions\n   - Units/modules/components breakdown\n   - Prerequisites, duration, certification\n   - Contact information\n   - Availability and schedules\n4. **Cross-References**: Link related information\n   - \"This course is also available in 3 other locations\"\n   - \"Similar to Course X but with focus on Y\"\n5. **Professional Structure**: Create nested, expandable views for complex data\n   - Main overview → Detailed breakdown → Specific items\n\nINSTRUCTIONS:\n- Return ONLY the JSON array inside ```json``` code blocks.\n- **Visual Storytelling**: The widgets should flow logically: Process -> Stats -> Charts -> Details.\n- **Contextualize**: Don't just show numbers. Use Titles and Descriptions.\n- **Analysis**: If the user asked for \"most repeated\" or \"top\", calculate it from the raw list (e.g. Top 5 Bar Chart).\n- **Empty/Error State**: If data is missing/error, use an \"insight\" widget to explain why (e.g. \"Try removing accents\") AND a \"process\" widget showing where it failed.\n- **Completeness**: Aim for at least 3 widgets: Process, Insight, and Data (Table/Chart).\n\nCRITICAL DATA FORMATTING RULES:\n1. **Chart Data Structure**: EVERY chart data item MUST have exactly these keys: { \"name\": \"Label\", \"value\": 123 }\n   - ❌ WRONG: { \"city\": \"São Paulo\", \"count\": 5 }\n   - ✅ CORRECT: { \"name\": \"São Paulo\", \"value\": 5 }\n2. **Table Data Completeness**: Include ALL rows from the input data. DO NOT truncate or sample.\n   - If input has 18 items, table MUST show all 18 items.\n   - Only limit if explicitly asked (e.g., \"top 5\").\n3. **Data Transformation**: Extract and transform raw API responses into clean, user-friendly formats.\n   - Remove internal IDs, technical fields, null values.\n   - Format dates, numbers, and text for readability.\n4. **Multi-Tool Results**: If multiple tools were called, create separate widgets for each result set.\n   - Example: One table for \"SENAI Units\", another table for \"Courses\".\n"
    }
  ],
  "model": "openai/gpt-4.1",
  "stream": false,
  "temperature": 0.7,
  "max_tokens": 4096
}